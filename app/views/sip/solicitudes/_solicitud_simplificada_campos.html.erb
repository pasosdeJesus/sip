<tr class='nested-fields'>
  <% if f.object.solicitud.nil? %>
    <% f.object.solicitud = Sip::Solicitud.new %>
  <% end %>
  <%= f.simple_fields_for :solicitud do |ob| %>
    <% if ob.object.usuario == current_usuario || current_usuario.rol == 1 || ob.object.usuario.nil?%>
      <% autorizado = true %>
    <% else %>
      <% autorizado = false %>
    <% end%>
    <td>
      <%= ob.association :usuario,
        collection: Usuario.habilitados,
        label_method: :nusuario,
        value_method: :id,
        readonly: true,
        selected:  ob.object.usuario_id || current_usuario.id,
        wrapper_html: {style: "width: 12em"},
        label: false,
        input_html: {
          class: 'deshabilitado'
        }
      %>
    </td>
    <td>
      <%= ob.input :fecha, 
        label: false,
        :input_html => { "data-behaviour" => "datepicker", 
                         value: Date.today, class: 'deshabilitado'},
                         :as => :string %>
    </td>
    <td>
      <% if autorizado %>
        <%= ob.input :solicitud,
          as: :text,
          label: false,
          :input_html => { 
            rows: 3
          }
        %>
      <% else %>
        <%= ob.input :solicitud,
          label: false,
          :input_html => { 
            class: 'deshabilitado'}
        %>
      <% end %>
    </td>
    <% if ob.object.usuario == current_usuario || 
         ob.object.usuario.nil? || current_usuario.rol == 1 %>
    <td>
      <%= link_to_remove_association "Eliminar", f, 
        :class => 'btn-danger',
        :'data-existing' => true
      %>
    </td>
    <% end %>
  <% end %>
</tr>
